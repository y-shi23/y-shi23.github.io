<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" name="viewport"><meta name="description" content="scipy稀疏矩阵"><meta name="hexo-theme-A4" content="v1.9.6"><link rel="alternate icon" type="image/webp" href="/vate.png"><title>Hello world | :)</title><link rel="stylesheet" href="/css/highlight/style1.css"><link rel="stylesheet" href="/css/reset.css"><link rel="stylesheet" href="/css/markdown.css"><link rel="stylesheet" href="/css/fonts.css"><link rel="stylesheet" href="/css/waline.css"><link rel="stylesheet" href="/css/ui.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/returnToTop.css"><link rel="stylesheet" href="/css/unicons.css"><link rel="stylesheet" href="/css/toc.css"><link rel="stylesheet" href="/css/returnToLastPage.css"><link rel="stylesheet" href="/css/lightgallery-bundle.min.css"><meta name="generator" content="Hexo 7.3.0"></head><style>.index-main{max-width:880px}</style><style>:root{--waline-theme-color:#fec591;--waline-color:#fec591;--waline-border-color:#fec591;--waline-white:#fec591;--waline-bgcolor-light:#005454}body{color:#fec591;background:#005454}.post-md code{background:#000;color:#fff}.post-md .highlight,.post-md pre{background:#000;color:#fff}pre .header,pre .inheritance,pre .ruby .symbol,pre .string,pre .value,pre .xml .cdata{color:#fec591}pre .built_in,pre .constant,pre .literal,pre .number,pre .params,pre .preprocessor{color:#fec591}.year-font-color{color:#fec591!important}.wl-card span.wl-nick{color:#fec591}.wl-card .wl-badge{border:1px solid #fec591;color:#fec591}.wl-btn{border:1px solid #fec591;color:#fec591}.wl-btn.primary{color:#005454}.wl-header label{color:#fec591}a{color:#fec591}.post-md a{color:#fec591}.nav li a{color:#fec591}.archive-main a:link{color:#fec591}.archive-main a:visited{color:#fec591}.archive li span{color:#fec591}.post-main-title{color:#fec591}.post-md h1,.post-md h2,.post-md h3,.post-md h4,.post-md h5,.post-md h6{color:#fec591}[data-waline] p{color:#fec591}[data-waline] a{color:#fec591}.wl-sort li.active{color:#fec591}.wl-card .wl-meta>span{background:#005454}.paper{background:#005454}.index-main{background:#005454}.paper-main{background:#005454}.wl-panel{background:#005454}.archive li:nth-child(odd){background:#005454}.archive li:nth-child(even){background:#005454}.post-md table tr:nth-child(odd) td{background:#005454}.post-md table tr:nth-child(even) td{background:#005454}.progress-wrap::after{color:#fec591}.progress-wrap svg.progress-circle path{stroke:#fec591}.progress-wrap::before{background-image:linear-gradient(298deg,#fec591,#fec591)}.return-to-last-progress-wrap::after{color:#fec591}.return-to-last-progress-wrap svg.progress-circle path{stroke:#fec591}.return-to-last-progress-wrap::before{background-image:linear-gradient(298deg,#fec591,#fec591)}.left-toc-container::-webkit-scrollbar-thumb{background-color:#fec591}.bs-docs-sidebar .nav>.active>a,.bs-docs-sidebar .nav>li>a:focus,.bs-docs-sidebar .nav>li>a:hover{color:#fec591;border-left-color:#fec591}.bs-docs-sidebar .nav>li>a{color:#fec591}</style><body><script src="/js/darkmode-js.min.js"></script><script>const options={bottom:"40px",right:"unset",left:"42px",time:"0.3s",mixColor:"#fff",backgroundColor:" #005454  ",buttonColorDark:"#100f2c",buttonColorLight:"#fff",saveInCookies:!0,label:"🌓",autoMatchOsTheme:!0},darkmode=new Darkmode(options);darkmode.showWidget()</script><div class="left-toc-container"><nav id="toc" class="bs-docs-sidebar"></nav></div><div class="paper"><div class="shadow-drop-2-bottom paper-main"><div class="header"><div class="header-container"><img style="width:56px;height:auto" alt="^-^" cache-control="max-age=86400" class="header-img" src="/vate.png" width="10%"><div class="header-content"><a class="logo" href="/">Hello world</a> <span class="description">Life love</span></div></div><ul class="nav"><li><a href="/">🏠首页</a></li><li><a href="/list/">📜文章</a></li><li><a href="/categories/">📁分类</a></li><li><a href="/about/">❓关于</a></li><li><a href="/navi/">NAVI</a></li></ul></div><div class="post-main"><div class="post-main-title" style="text-align:center">scipy稀疏矩阵</div><div class="post-head-meta-center"><span>最近更新：2024-11-25</span> &nbsp; | &nbsp; <span>字数总计：3.8k</span> &nbsp; | &nbsp; <span>阅读估时：16分钟</span> &nbsp; | &nbsp; <span id="busuanzi_container_page_pv">阅读量：<span id="busuanzi_value_page_pv"></span>次</span></div><div class="post-md"><ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95"><span class="post-toc-text">文章目录</span></a></li></ol><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%A8%80%E7%96%8F%E7%9F%A9%E9%98%B5%E6%A0%BC%E5%BC%8F"><span class="post-toc-text">稀疏矩阵格式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#coo-matrix"><span class="post-toc-text">coo_matrix</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#csr-matrix"><span class="post-toc-text">csr_matrix</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#csc-matrix"><span class="post-toc-text">csc_matrix</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#lil-matrix"><span class="post-toc-text">lil_matrix</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#dok-matrix"><span class="post-toc-text">dok_matrix</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#dia-matrix"><span class="post-toc-text">dia_matrix</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#bsr-matrix"><span class="post-toc-text">bsr_matrix</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%9E%E7%94%A8%E5%87%BD%E6%95%B0"><span class="post-toc-text">实用函数</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93"><span class="post-toc-text">经验总结</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8F%82%E8%80%83"><span class="post-toc-text">参考</span></a><div class=".article-gallery"><blockquote><p>原文地址 <a target="_blank" rel="noopener" href="https://blog.csdn.net/jeffery0207/article/details/100064602">blog.csdn.net</a></p></blockquote><h4 id="文章目录"><a href="#文章目录" class="headerlink" title="文章目录"></a>文章目录</h4><ul><li><a href="#_1">稀疏矩阵格式</a></li><li><ul><li><ul><li><a href="#coo_matrix_3">coo_matrix</a></li><li><a href="#csr_matrix_91">csr_matrix</a></li><li><a href="#csc_matrix_147">csc_matrix</a></li><li><a href="#lil_matrix_155">lil_matrix</a></li><li><a href="#dok_matrix_176">dok_matrix</a></li><li><a href="#dia_matrix_201">dia_matrix</a></li><li><a href="#bsr_matrix_229">bsr_matrix</a></li></ul></li></ul></li><li><a href="#_300">实用函数</a></li><li><a href="#_382">经验总结</a></li><li><a href="#_399">参考</a></li></ul><h2 id="稀疏矩阵格式"><a href="#稀疏矩阵格式" class="headerlink" title="稀疏矩阵格式"></a><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%A8%80%E7%96%8F%E7%9F%A9%E9%98%B5&spm=1001.2101.3001.7020">稀疏矩阵</a>格式</h2><h4 id="coo-matrix"><a href="#coo-matrix" class="headerlink" title="coo_matrix"></a>coo_matrix</h4><p>  <code>coo_matrix</code>是最简单的稀疏矩阵存储方式，采用三元组<code>(row, col, data)</code>(或称为<code>ijv format</code>) 的形式来存储矩阵中非零元素的信息。在实际使用中，一般<code>coo_matrix</code>用来创建矩阵，因为<code>coo_matrix</code>无法对矩阵的元素进行增删改操作；创建成功之后可以转化成其他格式的稀疏矩阵（如<code>csr_matrix</code>、<code>csc_matrix</code>）进行转置、矩阵乘法等操作。</p><p><a href="/./../img/246c38acc2926215c1bed2259267d2e3.gif" class="gallery-item" style="box-shadow:none"><img src="/./../img/246c38acc2926215c1bed2259267d2e3.gif"></a></p><p><code>coo_matrix</code>可以通过四种方式实例化，除了可以通过<code>coo_matrix(D)</code>, D 代表密集矩阵；<code>coo_matrix(S)</code>, S 代表其他类型稀疏矩阵或者<code>coo_matrix((M, N), [dtype])</code>构建一个 shape 为 M*N 的空矩阵，默认数据类型是<code>d</code>，还可以通过<code>(row, col, data)</code>三元组初始化：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import numpy as np</span><br><span class="line">&gt;&gt;&gt; from scipy.sparse import coo_matrix</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; _row  = np.array([0, 3, 1, 0])</span><br><span class="line">&gt;&gt;&gt; _col  = np.array([0, 3, 1, 2])</span><br><span class="line">&gt;&gt;&gt; _data = np.array([4, 5, 7, 9])</span><br><span class="line">&gt;&gt;&gt; coo = coo_matrix((_data, (_row, _col)), shape=(4, 4), dtype=np.int)</span><br><span class="line">&gt;&gt;&gt; coo.todense()  # 通过toarray方法转化成密集矩阵(numpy.matrix)</span><br><span class="line">&gt;&gt;&gt; coo.toarray()  # 通过toarray方法转化成密集矩阵(numpy.ndarray)</span><br><span class="line">array([[4, 0, 9, 0],</span><br><span class="line">       [0, 7, 0, 0],</span><br><span class="line">       [0, 0, 0, 0],</span><br><span class="line">       [0, 0, 0, 5]])</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上面通过<code>triplet format</code>的形式构建了一个<code>coo_matrix</code>对象，我们可以看到坐标点 (0,0) 对应值为 4，坐标点 (1,1) 对应值为 7 等等，这就是<code>coo_matrix</code>。<code>coo_matrix</code>对象有很多方法，大多数是 elementwise 的<a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.coo_matrix.html#scipy.sparse.coo_matrix">操作函数</a>；<code>coo_matrix</code>对象有以下属性：</p><ul><li><p><strong><code>dtype</code></strong> dtype</p><p>矩阵中元素的数据类型</p></li><li><p><strong><code>shape</code></strong> 2-tuple</p><p>获取矩阵的 shape</p></li><li><p><strong><code>ndim</code></strong> int</p><p>获取矩阵的维度，当然值是 2 咯</p></li><li><p><strong><code>nnz</code></strong></p><p>存储值的个数，包括显示声明的零元素 (注意)</p></li><li><p><strong><code>data</code></strong></p><p>稀疏矩阵存储的值，是一个一维数组，即上面例子中的<code>_data</code></p></li><li><p><strong><code>row</code></strong></p><p>与<code>data</code>同等长度的一维数组，表征<code>data</code>中每个元素的行号</p></li><li><p><strong><code>col</code></strong></p><p>与<code>data</code>同等长度的一维数组，表征<code>data</code>中每个元素的列号</p><p>在实际应用中，<code>coo_matrix</code>矩阵文件通常存成以下形式，表示稀疏矩阵是<code>coo_matrix</code>(<strong>coo</strong>rdinate)，由 13885 行 1 列组成，共有 949 个元素值为非零，数据类型为整形。</p></li></ul><p><a href="/./../img/b44de18edf0ae0d55b52797101751d3f.png" class="gallery-item" style="box-shadow:none"><img src="/./../img/b44de18edf0ae0d55b52797101751d3f.png"></a></p><p>下面给出<code>coo_matrix</code>矩阵文件读写示例代码，<code>mmread()</code>用于读取稀疏矩阵，<code>mmwrite()</code>用于写入稀疏矩阵，<code>mminfo()</code>用于查看稀疏矩阵文件元信息。(这三个函数的操作不仅仅限于<code>coo_matrix</code>)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from scipy.io import mmread, mmwrite, mminfo</span><br><span class="line"></span><br><span class="line">HERE = dirname(__file__)</span><br><span class="line">coo_mtx_path = join(HERE, &#x27;data/matrix.mtx&#x27;)</span><br><span class="line">coo_mtx = mmread(coo_mtx_path)</span><br><span class="line">print(mminfo(coo_mtx_path))</span><br><span class="line"># (13885, 1, 949, &#x27;coordinate&#x27;, &#x27;integer&#x27;, &#x27;general&#x27;)</span><br><span class="line"># (rows, cols, entries, format, field, symmetry)</span><br><span class="line">mmwrite(join(HERE, &#x27;data/saved_mtx.mtx&#x27;), coo_mtx)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>coo_matrix</code>的优点：</p><ul><li>有利于稀疏格式之间的快速转换（<code>tobsr()</code>、<code>tocsr()</code>、<code>to_csc()</code>、<code>to_dia()</code>、<code>to_dok()</code>、<code>to_lil()</code>）</li><li>允许又重复项（格式转换的时候自动相加）</li><li>能与 CSR &#x2F; CSC 格式的快速转换</li></ul><p><code>coo_matrix</code>的缺点：</p><ul><li>不能直接进行算术运算</li></ul><h4 id="csr-matrix"><a href="#csr-matrix" class="headerlink" title="csr_matrix"></a>csr_matrix</h4><p><code>csr_matrix</code>，全称<code>Compressed Sparse Row matrix</code>，即按行压缩的稀疏矩阵存储方式，由三个一维数组<code>indptr</code>, <code>indices</code>, <code>data</code>组成。这种格式要求矩阵元<strong>按行顺序存储</strong>，<strong>每一行中的元素可以乱序存储</strong>。那么对于每一行就只需要用一个指针表示该行元素的起始位置即可。<code>indptr</code>存储每一行数据元素的起始位置，<code>indices</code>这是存储每行中数据的列号，与<code>data</code>中的元素一一对应。</p><p><a href="/./../img/9e0fca97cc5164f26bdefc293f446993.gif" class="gallery-item" style="box-shadow:none"><img src="/./../img/9e0fca97cc5164f26bdefc293f446993.gif"></a></p><p><code>csr_matrix</code>可用于各种算术运算：它支持加法，减法，乘法，除法和矩阵幂等操作。其有五种实例化方法，其中前四种初始化方法类似<code>coo_matrix</code>，即通过密集矩阵构建、通过其他类型稀疏矩阵转化、构建一定 shape 的空矩阵、通过<code>(row, col, data)</code>构建矩阵。其第五种初始化方式这是直接体现<code>csr_matrix</code>的存储特征：<code>csr_matrix((data, indices, indptr), [shape=(M, N)])</code>，意思是，矩阵中第 i 行非零元素的列号为<code>indices[indptr[i]:indptr[i+1]]</code>，相应的值为<code>data[indptr[i]:indptr[i+1]]</code></p><p>举个例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import numpy as np</span><br><span class="line">&gt;&gt;&gt; from scipy.sparse import csr_matrix</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; indptr = np.array([0, 2, 3, 6])</span><br><span class="line">&gt;&gt;&gt; indices = np.array([0, 2, 2, 0, 1, 2])</span><br><span class="line">&gt;&gt;&gt; data = np.array([1, 2, 3, 4, 5, 6])</span><br><span class="line">&gt;&gt;&gt; csr = csr_matrix((data, indices, indptr), shape=(3, 3)).toarray()</span><br><span class="line">array([[1, 0, 2],</span><br><span class="line">       [0, 0, 3],</span><br><span class="line">       [4, 5, 6]])</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>csr_matrix</code>同样有很多方法，其中<code>tobytes()</code>，<code>tolist()</code>, <code>tofile()</code>，<code>tostring()</code>值得注意，其他具体参考<a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.csr_matrix.html#scipy.sparse.csr_matrix">官方文档</a>，<code>csr_matrix</code>对象属性前五个同<code>coo_matrix</code>，另外还有属性如下：</p><ul><li><p><strong><code>indices</code></strong></p><p>与属性<code>data</code>一一对应，元素值代表在某一行的列号</p></li><li><p><strong><code>indptr</code></strong></p><p><code>csr_matrix</code>各行的起始值，<code>length(csr_object.indptr) == csr_object.shape[0] + 1</code></p></li><li><p><strong><code>has_sorted_indices</code></strong></p><p>判断每一行的<code>indices</code>是否是有序的，返回 bool 值</p></li></ul><p><code>csr_matrix</code>的优点：</p><ul><li>高效的算术运算 CSR + CSR，CSR * CSR 等</li><li>高效的行切片</li><li>快速矩阵运算</li></ul><p><code>csr_matrix</code>的缺点：</p><ul><li>列切片操作比较慢（考虑 csc_matrix）</li><li>稀疏结构的转换比较慢（考虑 lil_matrix 或 doc_matrix）</li></ul><h4 id="csc-matrix"><a href="#csc-matrix" class="headerlink" title="csc_matrix"></a>csc_matrix</h4><p><code>csc_matrix</code>和<code>csr_matrix</code>正好相反，即按列压缩的稀疏矩阵存储方式，同样由三个一维数组<code>indptr</code>, <code>indices</code>, <code>data</code>组成，如下图所示：</p><p><a href="/./../img/211aa1ae6643a4d1e98ba4188236890f.gif" class="gallery-item" style="box-shadow:none"><img src="/./../img/211aa1ae6643a4d1e98ba4188236890f.gif"></a></p><p>其实例化方式、属性、方法、优缺点和<code>csr_matrix</code>基本一致，这里不再赘述，它们之间唯一的区别就是按行或按列压缩进行存储。而这一区别决定了<code>csr_matrix</code>擅长行操作；<code>csc_matrix</code>擅长列操作，进行运算时需要进行合理存储结构的选择。</p><h4 id="lil-matrix"><a href="#lil-matrix" class="headerlink" title="lil_matrix"></a>lil_matrix</h4><p><code>lil_matrix</code>，即 List of Lists format，又称为 Row-based linked list sparse <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=matrix&spm=1001.2101.3001.7020">matrix</a>。它使用两个嵌套列表存储稀疏矩阵：<code>data</code>保存每行中的非零元素的值，<code>rows</code>保存每行非零元素所在的列号 (列号是顺序排序的)。这种格式<strong>很适合逐个添加元素，并且能快速获取行相关的数据</strong>。其初始化方式同<code>coo_matrix</code>初始化的前三种方式：通过密集矩阵构建、通过其他矩阵转化以及构建一个一定 shape 的空矩阵。</p><p><a href="/./../img/ab26c8ace315556577e437fcd87e6f7c.gif" class="gallery-item" style="box-shadow:none"><img src="/./../img/ab26c8ace315556577e437fcd87e6f7c.gif"></a></p><p><code>lil_matrix</code>可用于算术运算：支持加法，减法，乘法，除法和矩阵幂。其属性前五个同<code>coo_matrix</code>，另外还有<code>rows</code>属性，是一个嵌套 List，表示矩阵每行中非零元素的列号。LIL matrix 本身的设计是用来方便快捷构建稀疏矩阵实例，而算术运算、矩阵运算则转化成 CSC、CSR 格式再进行，构建大型的稀疏矩阵还是推荐使用 COO 格式。</p><p>LIL format 优点</p><ul><li>支持灵活的切片操作_<strong>行切片操作效率高，列切片效率低</strong>_</li><li>稀疏矩阵格式之间的转化很高效（<code>tobsr()</code>、<code>tocsr()</code>、<code>to_csc()</code>、<code>to_dia()</code>、<code>to_dok()</code>、<code>to_lil()</code>）</li></ul><p>LIL format 缺点</p><ul><li>加法操作效率低 (consider CSR or CSC)</li><li>列切片效率低 (consider CSC)</li><li>矩阵乘法效率低 (consider CSR or CSC)</li></ul><h4 id="dok-matrix"><a href="#dok-matrix" class="headerlink" title="dok_matrix"></a>dok_matrix</h4><p>dok_matrix，即 Dictionary Of Keys based sparse matrix，是一种类似于 coo matrix 但又基于字典的稀疏矩阵存储方式，key 由非零元素的的坐标值<code>tuple(row, column)</code>组成，value 则代表数据值。dok matrix 非常适合于增量构建稀疏矩阵，并一旦构建，就可以快速地转换为<code>coo_matrix</code>。其属性和<code>coo_matrix</code>前四项同；其初始化方式同<code>coo_matrix</code>初始化的前三种：通过密集矩阵构建、通过其他矩阵转化以及构建一个一定 shape 的空矩阵。对于 dok matrix，可用于算术运算：它支持加法，减法，乘法，除法和矩阵幂；允许对单个元素进行快速访问（ O(1) ）; 不允许重复。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import numpy as np</span><br><span class="line">&gt;&gt;&gt; from scipy.sparse import dok_matrix</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; np.random.seed(10)</span><br><span class="line">&gt;&gt;&gt; matrix = random(3, 3, format=&#x27;dok&#x27;, density=0.4)</span><br><span class="line">&gt;&gt;&gt; matrix[1, 1] = 33</span><br><span class="line">&gt;&gt;&gt; matrix[2, 1] = 10</span><br><span class="line">&gt;&gt;&gt; matrix.toarray()</span><br><span class="line">array([[ 0.        ,  0.        ,  0.        ],</span><br><span class="line">       [ 0.        , 33.        ,  0.        ],</span><br><span class="line">       [ 0.19806286, 10.        ,  0.22479665]])</span><br><span class="line">&gt;&gt;&gt; dict(matrix)</span><br><span class="line">&#123;(2, 0): 0.19806286475962398, (2, 1): 10.0, (2, 2): 0.22479664553084766, (1, 1): 33.0&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; isinstance(matrix, dict)</span><br><span class="line">True</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在上面代码最后可以看到，实际上 dok_matrix 实例也是<code>dict</code>实例，在实现上继承了 dict 类。</p><h4 id="dia-matrix"><a href="#dia-matrix" class="headerlink" title="dia_matrix"></a>dia_matrix</h4><p>dia_matrix，全称 Sparse matrix with DIAgonal storage，是一种对角线的存储方式。如下图中，将稀疏矩阵使用<code>offsets</code>和<code>data</code>两个矩阵来表示。<code>offsets</code>表示<code>data</code>中每一行数据在原始稀疏矩阵中的对角线位置<code>k</code>（k&gt;0, 对角线往右上角移动；k&lt;0, 对角线往左下方移动；k&#x3D;0，主对角线）。该格式的稀疏矩阵可用于算术运算：它们支持加法，减法，乘法，除法和矩阵幂。</p><p><a href="/./../img/ef5f9ccd575c78d8b51b60af7bd3133e.gif" class="gallery-item" style="box-shadow:none"><img src="/./../img/ef5f9ccd575c78d8b51b60af7bd3133e.gif"></a></p><p>dia_matrix 五个属性同 coo matrix, 另外还有属性<code>offsets</code>；dia_matrix 有四种初始化方式，其中前三种初始化方式同 coo_matrix 前三种初始化方式，即：通过密集矩阵构建、通过其他矩阵转化以及构建一个一定 shape 的空矩阵。第四种初始化方式如下：</p><p><strong><code>dia_matrix((data, offsets), shape=(M, N))</code></strong> ,</p><p>其中，<code>data[k,:]</code>存储着稀疏矩阵<code>offsets[k]</code>对角线上的值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data = np.arange(15).reshape(3, -1) + 1</span><br><span class="line">&gt;&gt;&gt; offsets = np.array([0, -3, 2])</span><br><span class="line">&gt;&gt;&gt; dia = sparse.dia_matrix((data, offsets), shape=(7, 5))</span><br><span class="line">&gt;&gt;&gt; dia.toarray()</span><br><span class="line">array([[ 1,  0, 13,  0,  0],</span><br><span class="line">       [ 0,  2,  0, 14,  0],</span><br><span class="line">       [ 0,  0,  3,  0, 15],</span><br><span class="line">       [ 6,  0,  0,  4,  0],</span><br><span class="line">       [ 0,  7,  0,  0,  5],</span><br><span class="line">       [ 0,  0,  8,  0,  0],</span><br><span class="line">       [ 0,  0,  0,  9,  0]])</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>不是很常用, 了解即可</p><h4 id="bsr-matrix"><a href="#bsr-matrix" class="headerlink" title="bsr_matrix"></a>bsr_matrix</h4><p>bsr_matrix，全称 Block Sparse Row matrix，这种压缩方式极其类似 CSR 格式，但使用分块的思想对稀疏矩阵进行按行压缩。所以，BSR 适用于具有 dense 子矩阵的稀疏矩阵。该种矩阵有五种初始化方式，分别如下：</p><ul><li><p><strong><code>bsr_matrix(D, [blocksize=(R,C)])</code></strong></p><p>D 是一个<code>M*N</code>的二维 dense 矩阵；blocksize 需要满足条件：<code>M % R = 0</code>和<code>N % C = 0</code>，若不给定该参数，内部将会应用启发式的算法自动决定一个合适的 blocksize.</p></li><li><p><strong><code>bsr_matrix(S, [blocksize=(R,C)])</code></strong></p><p>S 是指其他类型的稀疏矩阵</p></li><li><p><strong><code>bsr_matrix((M, N), [blocksize=(R,C), dtype])</code></strong></p><p>构建一个 shape 为 M*N 的空矩阵</p></li><li><p><strong><code>bsr_matrix((data, ij), [blocksize=(R,C), shape=(M, N)])</code></strong></p><p><code>data</code> 和<code>ij</code> 满足条件： <code>a[ij[0, k], ij[1, k]] = data[k]</code></p></li><li><p><strong><code>bsr_matrix((data, indices, indptr), [shape=(M, N)])</code></strong></p><p><code>data.shape</code>一般是<code>k*R*C</code>，其中 R、C 分别代表 block 的行和列长，k 代表有几个小 block 矩阵；第 i 行的块列索引存储在<code>indices[indptr[i]:indptr[i+1]]</code>，其值是<code>data[ indptr[i]: indptr[i+1] ]</code>。</p></li></ul><p>bsr_matrix 可用于算术运算：支持加法，减法，乘法，除法和矩阵幂。如下面的例子，对于许多稀疏算术运算，BSR 比 CSR 和 CSC 更有效：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from scipy.sparse import bsr_matrix</span><br><span class="line">&gt;&gt;&gt; import numpy</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; indptr = np.array([0, 2, 3, 6])</span><br><span class="line">&gt;&gt;&gt; indices = np.array([0, 2, 2, 0, 1, 2])</span><br><span class="line">&gt;&gt;&gt; data = np.array([1, 2, 3, 4, 5, 6]).repeat(4).reshape(6, 2, 2)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; bsr_matrix((data,indices,indptr), shape=(6, 6)).toarray()</span><br><span class="line">array([[1, 1, 0, 0, 2, 2],</span><br><span class="line">       [1, 1, 0, 0, 2, 2],</span><br><span class="line">       [0, 0, 0, 0, 3, 3],</span><br><span class="line">       [0, 0, 0, 0, 3, 3],</span><br><span class="line">       [4, 4, 5, 5, 6, 6],</span><br><span class="line">       [4, 4, 5, 5, 6, 6]])</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以通过热图观察矩阵有没有明显分块模式再决定使不使用该方式</p><p>bsr matrix 对象拥有 9 个属性，前四个属性与 coo matrix 相同，另外还有以下属性 (注意 csr matrix 和 bsr matrix 之间的区别与联系)：</p><ul><li><p><strong><code>data</code></strong></p><p>即稀疏矩阵的数组，<code>data.shape</code>一般是<code>k*R*C</code></p></li><li><p><strong><code>indices</code></strong></p><p>与属性<code>data</code>中的 k 个二维矩阵一一对应，元素值代表在某一行的列号</p></li><li><p><strong><code>indptr</code></strong></p><p>bsr 各行起始起始值</p></li><li><p><strong><code>blocksize</code></strong></p><p>即 tuple(R,C)</p></li><li><p><strong><code>has_sorted_indices</code></strong></p><p>判断每一行的<code>indices</code>是否是有序的，返回 bool 值</p></li></ul><h2 id="实用函数"><a href="#实用函数" class="headerlink" title="实用函数"></a>实用函数</h2><ul><li>构造特殊稀疏矩阵</li></ul><p><code>scipy.sparse</code>模块还包含一些便捷函数，用于快速构建单位矩阵、对角矩阵等，下面做一个简单的汇总：</p><table><thead><tr><th>方法</th><th>用途</th></tr></thead><tbody><tr><td><code>identity</code>(n[, dtype, format])</td><td>生成稀疏单位矩阵</td></tr><tr><td><code>kron</code>(A, B[, format])</td><td>sparse matrices A 和 B 的<em>克罗内克</em>积</td></tr><tr><td><code>kronsum</code>(A, B[, format])</td><td>sparse matrices A 和 B 的<em>克罗内克</em>和</td></tr><tr><td><code>diags</code>(diagonals[, offsets, shape, format, dtype])</td><td>构建稀疏对角阵</td></tr><tr><td><code>spdiags</code>(data, diags, m, n[, format])</td><td>构建稀疏对角阵，同上，但不可指定 shape</td></tr><tr><td><code>block_diag</code>(mats[, format, dtype])</td><td>mats 为<code>iterable</code>, 包含多个矩阵，根据 mats 构建块对角稀疏矩阵。</td></tr><tr><td><code>tril</code>(A[, k, format])</td><td>以稀疏格式返回矩阵的下三角部分</td></tr><tr><td><code>triu</code>(A[, k, format])</td><td>以稀疏格式返回矩阵的上三角部分</td></tr><tr><td><code>bmat</code>(blocks[, format, dtype])</td><td>从稀疏子块构建稀疏矩阵</td></tr><tr><td><code>hstack</code>(blocks[, format, dtype])</td><td>水平堆叠稀疏矩阵 (column wise)</td></tr><tr><td><code>vstack</code>(blocks[, format, dtype])</td><td>垂直堆叠稀疏矩阵 (row wise)</td></tr><tr><td><code>rand</code>(m, n[, density, format, dtype, …])</td><td>使用均匀分布的值生成给定形状和密度的稀疏矩阵</td></tr><tr><td><code>random</code>(m, n[, density, format, dtype, …])</td><td>使用随机分布的值生成给定形状和密度的稀疏矩阵</td></tr><tr><td><code>eye</code>(m[, n, k, dtype, format])</td><td>生成稀疏单位对角阵（默认<code>DIAgonal format</code>）</td></tr></tbody></table><p><code>scipy.sparse.bmat</code>举例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">In [1]: A = np.arange(8).reshape(2, 4)</span><br><span class="line"></span><br><span class="line">In [2]: T = np.tri(5, 4)</span><br><span class="line"></span><br><span class="line">In [3]: L = [[8] * 4] * 2</span><br><span class="line"></span><br><span class="line">In [4]: I = sparse.identity(4)</span><br><span class="line"></span><br><span class="line">In [5]: Z = sparse.coo_matrix((2, 3))</span><br><span class="line"></span><br><span class="line">In [6]: sp.bmat([[   A,    Z,    L],</span><br><span class="line">    ...:          [None, None,    I],</span><br><span class="line">    ...:          [   T, None, None]], dtype=int)</span><br><span class="line">Out[7]:</span><br><span class="line">&lt;11x11 sparse matrix of type &#x27;&lt;class &#x27;numpy.int64&#x27;&gt;&#x27;</span><br><span class="line">        with 33 stored elements in COOrdinate format&gt;</span><br><span class="line"></span><br><span class="line">In [8]: _.toarray()  # ipython previous output</span><br><span class="line">Out[9]:</span><br><span class="line">array([[0, 1, 2, 3, 0, 0, 0, 8, 8, 8, 8],</span><br><span class="line">       [4, 5, 6, 7, 0, 0, 0, 8, 8, 8, 8],</span><br><span class="line">       [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],</span><br><span class="line">       [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],</span><br><span class="line">       [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],</span><br><span class="line">       [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],</span><br><span class="line">       [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],</span><br><span class="line">       [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],</span><br><span class="line">       [1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0],</span><br><span class="line">       [1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0],</span><br><span class="line">       [1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0]])</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>稀疏矩阵类型判断</p><p><code>scipy.sparse</code>模块还包含一些判断稀疏矩阵类型的函数，这里需要注意的是，<code>issparse()</code> 和 <code>isspmatrix()</code> 是相同的函数，也许是由于历史原因保留下来了两个。</p><ul><li><code>isspars(x)</code></li><li><code>isspmatrix(x)</code></li><li><code>isspmatrix_csc(x)</code></li><li><code>isspmatrix_csr(x)</code></li><li><code>isspmatrix_bsr(x)</code></li><li><code>isspmatrix_lil(x)</code></li><li><code>isspmatrix_dok(x)</code></li><li><code>isspmatrix_coo(x)</code></li><li><code>isspmatrix_dia(x)</code></li></ul></li><li><p>稀疏矩阵存取</p><ul><li><code>load_npz(file)</code> 从<code>.npz</code>文件中读取稀疏矩阵</li><li><code>save_npz(file, matrix[,compressed])</code> 将稀疏矩阵写入<code>.npz</code>文件中</li></ul></li><li><p>其他</p><ul><li><code>find(A)</code> 返回稀疏矩阵中非零元素的索引以及值</li></ul></li></ul><h2 id="经验总结"><a href="#经验总结" class="headerlink" title="经验总结"></a>经验总结</h2><ul><li><p>要有效地构造矩阵，请使用<code>dok_matrix</code>或<code>lil_matrix</code></p><p><code>lil_matrix</code>类支持基本切片和花式索引，其语法与 NumPy Array 类似；lil_matrix 形式是基于 row 的，因此能够很高效的转为 csr，但是转为 csc 效率相对较低。</p></li><li><p>强烈建议不要直接使用 NumPy 函数运算稀疏矩阵</p><p>如果你想将 NumPy 函数应用于这些矩阵，首先要检查 SciPy 是否有自己的给定稀疏矩阵类的实现，或者首先将稀疏矩阵转换为 NumPy 数组（使用类的<code>toarray()</code>方法）。</p></li><li><p>要执行乘法或转置等操作，首先将矩阵转换为 CSC 或 CSR 格式，效率高</p><p>CSR 格式特别适用于快速矩阵矢量产品</p></li><li><p><code>CSR</code>，<code>CSC</code>和<code>COO</code>格式之间的所有转换都是线性复杂度。</p></li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://matteding.github.io/2019/04/25/sparse-matrices/">matteding</a><br><a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/scipy/reference/sparse.html">scipy sparse</a></p></div></li></div><div class="post-meta"><i><span>2024-11-25</span> <span>该篇文章被 Stone Ocean</span> <span>归为分类: <a href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></span></i></div><br><div class="post-footer-pre-next"><span>上一篇：<a href="/posts/3005439712/">Modalverben</a></span> <span class="post-footer-pre-next-last-span-right">下一篇：<a href="/posts/3233623394/">Mechine learning(python)</a></span></div><div class="comments-container"><div id="comment-anchor"></div><div class="comment-area-title"></div><div id="waline"></div><script type="module">import{init}from"https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/waline.mjs";function loadWaline(){init({el:"#waline",serverURL:"https://blogcomment-ivory.vercel.app",lang:"zh-CN",dark:'body[class~="dark-mode"]',requiredMeta:["nick","mail"],search:!1,reaction:!1,pageview:!1,comment:!1,locale:{placeholder:"留下你的评论吧!",sofa:""}})}window.addEventListener("DOMContentLoaded",loadWaline)</script></div></div><div class="footer"><span>© 2023-2024 Ocean / <a href="/friends/">友链</a></span></div><div class="footer-last"><span>那年夏天宁静的海</span></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript"></script><script src="/js/toc.js"></script><script src="/js/randomHeaderContent.js"></script><script src="/js/returnToTop.js"></script><script src="/js/returnToLastPage.js"></script><script src="/js/lightgallery/lightgallery.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script><script type="text/javascript">if("undefined"!=typeof lightGallery){var options1={selector:".gallery-item",plugins:[lgThumbnail,lgFullscreen,lgAutoplay,lgZoom,lgRotate,lgPager],thumbnail:!1,zoom:!1,rotate:!1,autoplay:!1,fullScreen:!1,pager:!1,zoomFromOrigin:!0,actualSize:!0,enableZoomAfter:300};lightGallery(document.getElementsByClassName(".article-gallery")[0],options1)}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="progress-wrap shadow-drop-2-bottom"><svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102"><path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/></svg></div><div class="return-to-last-progress-wrap shadow-drop-2-bottom"><svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102"><path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/></svg></div></div></body></html>
<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" name="viewport"><meta name="description" content="如何搭建微信chatbot"><meta name="hexo-theme-A4" content="v1.9.6"><link rel="alternate icon" type="image/webp" href="/vate.png"><title>Hello world | :)</title><link rel="stylesheet" href="/css/highlight/style1.css"><link rel="stylesheet" href="/css/reset.css"><link rel="stylesheet" href="/css/markdown.css"><link rel="stylesheet" href="/css/fonts.css"><link rel="stylesheet" href="/css/waline.css"><link rel="stylesheet" href="/css/ui.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/returnToTop.css"><link rel="stylesheet" href="/css/unicons.css"><link rel="stylesheet" href="/css/toc.css"><link rel="stylesheet" href="/css/returnToLastPage.css"><link rel="stylesheet" href="/css/lightgallery-bundle.min.css"><meta name="generator" content="Hexo 7.3.0"></head><style>.index-main{max-width:880px}</style><style>:root{--waline-theme-color:#fec591;--waline-color:#fec591;--waline-border-color:#fec591;--waline-white:#fec591;--waline-bgcolor-light:#005454}body{color:#fec591;background:#005454}.post-md code{background:#000;color:#fff}.post-md .highlight,.post-md pre{background:#000;color:#fff}pre .header,pre .inheritance,pre .ruby .symbol,pre .string,pre .value,pre .xml .cdata{color:#fec591}pre .built_in,pre .constant,pre .literal,pre .number,pre .params,pre .preprocessor{color:#fec591}.year-font-color{color:#fec591!important}.wl-card span.wl-nick{color:#fec591}.wl-card .wl-badge{border:1px solid #fec591;color:#fec591}.wl-btn{border:1px solid #fec591;color:#fec591}.wl-btn.primary{color:#005454}.wl-header label{color:#fec591}a{color:#fec591}.post-md a{color:#fec591}.nav li a{color:#fec591}.archive-main a:link{color:#fec591}.archive-main a:visited{color:#fec591}.archive li span{color:#fec591}.post-main-title{color:#fec591}.post-md h1,.post-md h2,.post-md h3,.post-md h4,.post-md h5,.post-md h6{color:#fec591}[data-waline] p{color:#fec591}[data-waline] a{color:#fec591}.wl-sort li.active{color:#fec591}.wl-card .wl-meta>span{background:#005454}.paper{background:#005454}.index-main{background:#005454}.paper-main{background:#005454}.wl-panel{background:#005454}.archive li:nth-child(odd){background:#005454}.archive li:nth-child(even){background:#005454}.post-md table tr:nth-child(odd) td{background:#005454}.post-md table tr:nth-child(even) td{background:#005454}.progress-wrap::after{color:#fec591}.progress-wrap svg.progress-circle path{stroke:#fec591}.progress-wrap::before{background-image:linear-gradient(298deg,#fec591,#fec591)}.return-to-last-progress-wrap::after{color:#fec591}.return-to-last-progress-wrap svg.progress-circle path{stroke:#fec591}.return-to-last-progress-wrap::before{background-image:linear-gradient(298deg,#fec591,#fec591)}.left-toc-container::-webkit-scrollbar-thumb{background-color:#fec591}.bs-docs-sidebar .nav>.active>a,.bs-docs-sidebar .nav>li>a:focus,.bs-docs-sidebar .nav>li>a:hover{color:#fec591;border-left-color:#fec591}.bs-docs-sidebar .nav>li>a{color:#fec591}</style><body><script src="/js/darkmode-js.min.js"></script><script>const options={bottom:"40px",right:"unset",left:"42px",time:"0.3s",mixColor:"#fff",backgroundColor:" #005454  ",buttonColorDark:"#100f2c",buttonColorLight:"#fff",saveInCookies:!0,label:"🌓",autoMatchOsTheme:!0},darkmode=new Darkmode(options);darkmode.showWidget()</script><div class="left-toc-container"><nav id="toc" class="bs-docs-sidebar"></nav></div><div class="paper"><div class="shadow-drop-2-bottom paper-main"><div class="header"><div class="header-container"><img style="width:56px;height:auto" alt="^-^" cache-control="max-age=86400" class="header-img" src="/vate.png" width="10%"><div class="header-content"><a class="logo" href="/">Hello world</a> <span class="description">Life love</span></div></div><ul class="nav"><li><a href="/">🏠首页</a></li><li><a href="/list/">📜文章</a></li><li><a href="/categories/">📁分类</a></li><li><a href="/about/">❓关于</a></li></ul></div><div class="post-main"><div class="post-main-title" style="text-align:center">如何搭建微信chatbot</div><div class="post-head-meta-center"><span>最近更新：2024-11-21</span> &nbsp; | &nbsp; <span>字数总计：3.4k</span> &nbsp; | &nbsp; <span>阅读估时：13分钟</span> &nbsp; | &nbsp; <span id="busuanzi_container_page_pv">阅读量：<span id="busuanzi_value_page_pv"></span>次</span></div><div class="post-md"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA-chatgpt-on-wechat"><span class="post-toc-text">如何搭建微信聊天机器人(chatgpt-on-wechat)</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#I-chatgpt-on-wechat"><span class="post-toc-text">I. chatgpt-on-wechat</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AE%98%E6%96%B9%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3"><span class="post-toc-text">官方使用文档</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%80%E3%80%81%E5%87%86%E5%A4%87"><span class="post-toc-text">一、准备</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-%E8%B4%A6%E5%8F%B7%E6%B3%A8%E5%86%8C"><span class="post-toc-text">1. 账号注册</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="post-toc-text">2.运行环境</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BA%8C%E3%80%81%E9%85%8D%E7%BD%AE"><span class="post-toc-text">二、配置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%89%E3%80%81%E8%BF%90%E8%A1%8C"><span class="post-toc-text">三、运行</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-%E6%9C%AC%E5%9C%B0%E8%BF%90%E8%A1%8C"><span class="post-toc-text">1.本地运行</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="post-toc-text">2.服务器部署</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-Docker%E9%83%A8%E7%BD%B2"><span class="post-toc-text">3.Docker部署</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-Railway%E9%83%A8%E7%BD%B2"><span class="post-toc-text">4. Railway部署</span></a></li></ol></li></ol><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%F0%9F%94%8E-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="post-toc-text">🔎 常见问题</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#II-%E4%BD%BF%E7%94%A8kimi"><span class="post-toc-text">II. 使用kimi</span></a></li><div class=".article-gallery"><h1 id="如何搭建微信聊天机器人-chatgpt-on-wechat"><a href="#如何搭建微信聊天机器人-chatgpt-on-wechat" class="headerlink" title="如何搭建微信聊天机器人(chatgpt-on-wechat)"></a>如何搭建微信聊天机器人(chatgpt-on-wechat)</h1><h1 id="I-chatgpt-on-wechat"><a href="#I-chatgpt-on-wechat" class="headerlink" title="I. chatgpt-on-wechat"></a>I. chatgpt-on-wechat</h1><p><code>Github</code> 地址：<a target="_blank" rel="noopener" href="https://github.com/zhayujie/chatgpt-on-wechat">chatgpt-on-wechat</a></p><blockquote><p>chatgpt-on-wechat（简称CoW）项目是基于大模型的智能对话机器人，支持微信公众号、企业微信应用、飞书、钉钉接入，可选择GPT3.5&#x2F;GPT4.0&#x2F;Claude&#x2F;Gemini&#x2F;LinkAI&#x2F;ChatGLM&#x2F;KIMI&#x2F;文心一言&#x2F;讯飞星火&#x2F;通义千问&#x2F;LinkAI，能处理文本、语音和图片，通过插件访问操作系统和互联网等外部资源，支持基于自有知识库定制企业AI应用。</p></blockquote><p>最新版本支持的功能如下：</p><ul><li>✅ <strong>多端部署：</strong> 有多种部署方式可选择且功能完备，目前已支持微信公众号、企业微信应用、飞书、钉钉等部署方式</li><li>✅ <strong>基础对话：</strong> 私聊及群聊的消息智能回复，支持多轮会话上下文记忆，支持 GPT-3.5, GPT-4o-mini, GPT-4o, GPT-4, Claude-3.5, Gemini, 文心一言, 讯飞星火, 通义千问，ChatGLM-4，Kimi(月之暗面), MiniMax</li><li>✅ <strong>语音能力：</strong> 可识别语音消息，通过文字或语音回复，支持 azure, baidu, google, openai(whisper&#x2F;tts) 等多种语音模型</li><li>✅ <strong>图像能力：</strong> 支持图片生成、图片识别、图生图（如照片修复），可选择 Dall-E-3, stable diffusion, replicate, midjourney, CogView-3, vision模型</li><li>✅ <strong>丰富插件：</strong> 支持个性化插件扩展，已实现多角色切换、文字冒险、敏感词过滤、聊天记录总结、文档总结和对话、联网搜索等插件</li><li>✅ <strong>知识库：</strong> 通过上传知识库文件自定义专属机器人，可作为数字分身、智能客服、私域助手使用，基于 <a target="_blank" rel="noopener" href="https://link-ai.tech/">LinkAI</a> 实现</li></ul><h3 id="官方使用文档"><a href="#官方使用文档" class="headerlink" title="官方使用文档"></a>官方使用文档</h3><h2 id="一、准备"><a href="#一、准备" class="headerlink" title="一、准备"></a>一、准备</h2><h3 id="1-账号注册"><a href="#1-账号注册" class="headerlink" title="1. 账号注册"></a>1. 账号注册</h3><p>项目默认使用OpenAI接口，需前往 <a target="_blank" rel="noopener" href="https://beta.openai.com/signup">OpenAI注册页面</a> 创建账号，创建完账号则前往 <a target="_blank" rel="noopener" href="https://beta.openai.com/account/api-keys">API管理页面</a> 创建一个 API Key 并保存下来，后面需要在项目中配置这个key。接口需要海外网络访问及绑定信用卡支付。</p><blockquote><p>默认对话模型是 openai 的 gpt-3.5-turbo，计费方式是约每 1000tokens (约750个英文单词 或 500汉字，包含请求和回复) 消耗 $0.002，图片生成是Dell E模型，每张消耗 $0.016。</p></blockquote><p>项目同时也支持使用 LinkAI 接口，无需代理，可使用 Kimi、文心、讯飞、GPT-3.5、GPT-4o 等模型，支持 定制化知识库、联网搜索、MJ绘图、文档总结、工作流等能力。修改配置即可一键使用，参考 <a target="_blank" rel="noopener" href="https://link-ai.tech/platform/link-app/wechat">接入文档</a>。</p><h3 id="2-运行环境"><a href="#2-运行环境" class="headerlink" title="2.运行环境"></a>2.运行环境</h3><p>支持 Linux、MacOS、Windows 系统（可在Linux服务器上长期运行)，同时需安装 <code>Python</code>。</p><blockquote><p>建议Python版本在 3.7.1~3.9.X 之间，推荐3.8版本，3.10及以上版本在 MacOS 可用，其他系统上不确定能否正常运行。</p></blockquote><blockquote><p>注意：Docker 或 Railway 部署无需安装python环境和下载源码，可直接快进到下一节。</p></blockquote><p><strong>(1) 克隆项目代码：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/zhayujie/chatgpt-on-wechat</span><br><span class="line"><span class="built_in">cd</span> chatgpt-on-wechat/</span><br></pre></td></tr></table></figure><p>注: 如遇到网络问题可选择国内镜像 <a target="_blank" rel="noopener" href="https://gitee.com/zhayujie/chatgpt-on-wechat">https://gitee.com/zhayujie/chatgpt-on-wechat</a></p><p><strong>(2) 安装核心依赖 (必选)：</strong></p><blockquote><p>能够使用<code>itchat</code>创建机器人，并具有文字交流功能所需的最小依赖集合。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -r requirements.txt</span><br></pre></td></tr></table></figure><p><strong>(3) 拓展依赖 (可选，建议安装)：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -r requirements-optional.txt</span><br></pre></td></tr></table></figure><blockquote><p>如果某项依赖安装失败可注释掉对应的行再继续</p></blockquote><h2 id="二、配置"><a href="#二、配置" class="headerlink" title="二、配置"></a>二、配置</h2><p>配置文件的模板在根目录的<code>config-template.json</code>中，需复制该模板创建最终生效的 <code>config.json</code> 文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> config-template.json config.json</span><br></pre></td></tr></table></figure><p>然后在<code>config.json</code>中填入配置，以下是对默认配置的说明，可根据需要进行自定义修改（注意实际使用时请去掉注释，保证JSON格式的完整）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config.json文件内容示例</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;model&quot;</span>: <span class="string">&quot;gpt-3.5-turbo&quot;</span>,                                   <span class="comment"># 模型名称, 支持 gpt-3.5-turbo, gpt-4, gpt-4-turbo, wenxin, xunfei, glm-4, claude-3-haiku, moonshot</span></span><br><span class="line">  <span class="string">&quot;open_ai_api_key&quot;</span>: <span class="string">&quot;YOUR API KEY&quot;</span>,                          <span class="comment"># 如果使用openAI模型则填入上面创建的 OpenAI API KEY</span></span><br><span class="line">  <span class="string">&quot;proxy&quot;</span>: <span class="string">&quot;&quot;</span>,                                                <span class="comment"># 代理客户端的ip和端口，国内环境开启代理的需要填写该项，如 &quot;127.0.0.1:7890&quot;</span></span><br><span class="line">  <span class="string">&quot;single_chat_prefix&quot;</span>: [<span class="string">&quot;bot&quot;</span>, <span class="string">&quot;@bot&quot;</span>],                      <span class="comment"># 私聊时文本需要包含该前缀才能触发机器人回复</span></span><br><span class="line">  <span class="string">&quot;single_chat_reply_prefix&quot;</span>: <span class="string">&quot;[bot] &quot;</span>,                       <span class="comment"># 私聊时自动回复的前缀，用于区分真人</span></span><br><span class="line">  <span class="string">&quot;group_chat_prefix&quot;</span>: [<span class="string">&quot;@bot&quot;</span>],                              <span class="comment"># 群聊时包含该前缀则会触发机器人回复</span></span><br><span class="line">  <span class="string">&quot;group_name_white_list&quot;</span>: [<span class="string">&quot;ChatGPT测试群&quot;</span>, <span class="string">&quot;ChatGPT测试群2&quot;</span>], <span class="comment"># 开启自动回复的群名称列表</span></span><br><span class="line">  <span class="string">&quot;group_chat_in_one_session&quot;</span>: [<span class="string">&quot;ChatGPT测试群&quot;</span>],              <span class="comment"># 支持会话上下文共享的群名称  </span></span><br><span class="line">  <span class="string">&quot;image_create_prefix&quot;</span>: [<span class="string">&quot;画&quot;</span>, <span class="string">&quot;看&quot;</span>, <span class="string">&quot;找&quot;</span>],                   <span class="comment"># 开启图片回复的前缀</span></span><br><span class="line">  <span class="string">&quot;conversation_max_tokens&quot;</span>: 1000,                            <span class="comment"># 支持上下文记忆的最多字符数</span></span><br><span class="line">  <span class="string">&quot;speech_recognition&quot;</span>: <span class="literal">false</span>,                                <span class="comment"># 是否开启语音识别</span></span><br><span class="line">  <span class="string">&quot;group_speech_recognition&quot;</span>: <span class="literal">false</span>,                          <span class="comment"># 是否开启群组语音识别</span></span><br><span class="line">  <span class="string">&quot;voice_reply_voice&quot;</span>: <span class="literal">false</span>,                                 <span class="comment"># 是否使用语音回复语音</span></span><br><span class="line">  <span class="string">&quot;character_desc&quot;</span>: <span class="string">&quot;你是基于大语言模型的AI智能助手，旨在回答并解决人们的任何问题，并且可以使用多种语言与人交流。&quot;</span>,  <span class="comment"># 人格描述</span></span><br><span class="line">  <span class="comment"># 订阅消息，公众号和企业微信channel中请填写，当被订阅时会自动回复，可使用特殊占位符。目前支持的占位符有&#123;trigger_prefix&#125;，在程序中它会自动替换成bot的触发词。</span></span><br><span class="line">  <span class="string">&quot;subscribe_msg&quot;</span>: <span class="string">&quot;感谢您的关注！\n这里是ChatGPT，可以自由对话。\n支持语音对话。\n支持图片输出，画字开头的消息将按要求创作图片。\n支持角色扮演和文字冒险等丰富插件。\n输入&#123;trigger_prefix&#125;#help 查看详细指令。&quot;</span>,</span><br><span class="line">  <span class="string">&quot;use_linkai&quot;</span>: <span class="literal">false</span>,                                        <span class="comment"># 是否使用LinkAI接口，默认关闭，开启后可国内访问，使用知识库和MJ</span></span><br><span class="line">  <span class="string">&quot;linkai_api_key&quot;</span>: <span class="string">&quot;&quot;</span>,                                       <span class="comment"># LinkAI Api Key</span></span><br><span class="line">  <span class="string">&quot;linkai_app_code&quot;</span>: <span class="string">&quot;&quot;</span>                                       <span class="comment"># LinkAI 应用或工作流code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>配置说明：</strong></p><p><strong>1.个人聊天</strong></p><ul><li>个人聊天中，需要以 “bot”或”@bot” 为开头的内容触发机器人，对应配置项 <code>single_chat_prefix</code> (如果不需要以前缀触发可以填写 <code>&quot;single_chat_prefix&quot;: [&quot;&quot;]</code>)</li><li>机器人回复的内容会以 “[bot] “ 作为前缀， 以区分真人，对应的配置项为 <code>single_chat_reply_prefix</code> (如果不需要前缀可以填写 <code>&quot;single_chat_reply_prefix&quot;: &quot;&quot;</code>)</li></ul><p><strong>2.群组聊天</strong></p><ul><li>群组聊天中，群名称需配置在 <code>group_name_white_list</code> 中才能开启群聊自动回复。如果想对所有群聊生效，可以直接填写 <code>&quot;group_name_white_list&quot;: [&quot;ALL_GROUP&quot;]</code></li><li>默认只要被人 @ 就会触发机器人自动回复；另外群聊天中只要检测到以 “@bot” 开头的内容，同样会自动回复（方便自己触发），这对应配置项 <code>group_chat_prefix</code></li><li>可选配置: <code>group_name_keyword_white_list</code>配置项支持模糊匹配群名称，<code>group_chat_keyword</code>配置项则支持模糊匹配群消息内容，用法与上述两个配置项相同。（Contributed by <a target="_blank" rel="noopener" href="https://github.com/evolay">evolay</a>)</li><li><code>group_chat_in_one_session</code>：使群聊共享一个会话上下文，配置 <code>[&quot;ALL_GROUP&quot;]</code> 则作用于所有群聊</li></ul><p><strong>3.语音识别</strong></p><ul><li>添加 <code>&quot;speech_recognition&quot;: true</code> 将开启语音识别，默认使用openai的whisper模型识别为文字，同时以文字回复，该参数仅支持私聊 (注意由于语音消息无法匹配前缀，一旦开启将对所有语音自动回复，支持语音触发画图)；</li><li>添加 <code>&quot;group_speech_recognition&quot;: true</code> 将开启群组语音识别，默认使用openai的whisper模型识别为文字，同时以文字回复，参数仅支持群聊 (会匹配group_chat_prefix和group_chat_keyword, 支持语音触发画图)；</li><li>添加 <code>&quot;voice_reply_voice&quot;: true</code> 将开启语音回复语音（同时作用于私聊和群聊）</li></ul><p><strong>4.其他配置</strong></p><ul><li><code>model</code>: 模型名称，目前支持 <code>gpt-3.5-turbo</code>, <code>gpt-4o-mini</code>, <code>gpt-4o</code>, <code>gpt-4</code>, <code>wenxin</code> , <code>claude</code> , <code>gemini</code>, <code>glm-4</code>, <code>xunfei</code>, <code>moonshot</code>等，全部模型名称参考<a target="_blank" rel="noopener" href="https://github.com/zhayujie/chatgpt-on-wechat/blob/master/common/const.py">common&#x2F;const.py</a>文件</li><li><code>temperature</code>,<code>frequency_penalty</code>,<code>presence_penalty</code>: Chat API接口参数，详情参考<a target="_blank" rel="noopener" href="https://platform.openai.com/docs/api-reference/chat">OpenAI官方文档。</a></li><li><code>proxy</code>：由于目前 <code>openai</code> 接口国内无法访问，需配置代理客户端的地址，详情参考 <a target="_blank" rel="noopener" href="https://github.com/zhayujie/chatgpt-on-wechat/issues/351">#351</a></li><li>对于图像生成，在满足个人或群组触发条件外，还需要额外的关键词前缀来触发，对应配置 <code>image_create_prefix</code></li><li>关于OpenAI对话及图片接口的参数配置（内容自由度、回复字数限制、图片大小等），可以参考 <a target="_blank" rel="noopener" href="https://beta.openai.com/docs/api-reference/completions">对话接口</a> 和 <a target="_blank" rel="noopener" href="https://beta.openai.com/docs/api-reference/completions">图像接口</a> 文档，在<a target="_blank" rel="noopener" href="https://github.com/zhayujie/chatgpt-on-wechat/blob/master/config.py"><code>config.py</code></a>中检查哪些参数在本项目中是可配置的。</li><li><code>conversation_max_tokens</code>：表示能够记忆的上下文最大字数（一问一答为一组对话，如果累积的对话字数超出限制，就会优先移除最早的一组对话）</li><li><code>rate_limit_chatgpt</code>，<code>rate_limit_dalle</code>：每分钟最高问答速率、画图速率，超速后排队按序处理。</li><li><code>clear_memory_commands</code>: 对话内指令，主动清空前文记忆，字符串数组可自定义指令别名。</li><li><code>hot_reload</code>: 程序退出后，暂存等于状态，默认关闭。</li><li><code>character_desc</code> 配置中保存着你对机器人说的一段话，他会记住这段话并作为他的设定，你可以为他定制任何人格 (关于会话上下文的更多内容参考该 <a target="_blank" rel="noopener" href="https://github.com/zhayujie/chatgpt-on-wechat/issues/43">issue</a>)</li><li><code>subscribe_msg</code>：订阅消息，公众号和企业微信channel中请填写，当被订阅时会自动回复， 可使用特殊占位符。目前支持的占位符有{trigger_prefix}，在程序中它会自动替换成bot的触发词。</li></ul><p><strong>5.LinkAI配置 (可选)</strong></p><ul><li><code>use_linkai</code>: 是否使用LinkAI接口，开启后可国内访问，使用知识库和 <code>Midjourney</code> 绘画, 参考 <a target="_blank" rel="noopener" href="https://link-ai.tech/platform/link-app/wechat">文档</a></li><li><code>linkai_api_key</code>: LinkAI Api Key，可在 <a target="_blank" rel="noopener" href="https://link-ai.tech/console/interface">控制台</a> 创建</li><li><code>linkai_app_code</code>: LinkAI 应用或工作流的code，选填</li></ul><p><strong>本说明文档可能会未及时更新，当前所有可选的配置项均在该<a target="_blank" rel="noopener" href="https://github.com/zhayujie/chatgpt-on-wechat/blob/master/config.py"><code>config.py</code></a>中列出。</strong></p><h2 id="三、运行"><a href="#三、运行" class="headerlink" title="三、运行"></a>三、运行</h2><h3 id="1-本地运行"><a href="#1-本地运行" class="headerlink" title="1.本地运行"></a>1.本地运行</h3><p>如果是开发机 <strong>本地运行</strong>，直接在项目根目录下执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 app.py                                    <span class="comment"># windows环境下该命令通常为 python app.py</span></span><br></pre></td></tr></table></figure><p>终端输出二维码后，进行扫码登录，当输出 “Start auto replying” 时表示自动回复程序已经成功运行了（注意：用于登录的账号需要在支付处已完成实名认证）。扫码登录后你的账号就成为机器人了，可以在手机端通过配置的关键词触发自动回复 (任意好友发送消息给你，或是自己发消息给好友)，参考<a target="_blank" rel="noopener" href="https://github.com/zhayujie/chatgpt-on-wechat/issues/142">#142</a>。</p><h3 id="2-服务器部署"><a href="#2-服务器部署" class="headerlink" title="2.服务器部署"></a>2.服务器部署</h3><p>使用nohup命令在后台运行程序：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> python3 app.py &amp; <span class="built_in">tail</span> -f nohup.out          <span class="comment"># 在后台运行程序并通过日志输出二维码</span></span><br></pre></td></tr></table></figure><p>扫码登录后程序即可运行于服务器后台，此时可通过 <code>ctrl+c</code> 关闭日志，不会影响后台程序的运行。使用 <code>ps -ef | grep app.py | grep -v grep</code> 命令可查看运行于后台的进程，如果想要重新启动程序可以先 <code>kill</code> 掉对应的进程。日志关闭后如果想要再次打开只需输入 <code>tail -f nohup.out</code>。此外，<code>scripts</code> 目录下有一键运行、关闭程序的脚本供使用。</p><blockquote><p><strong>多账号支持：</strong> 将项目复制多份，分别启动程序，用不同账号扫码登录即可实现同时运行。</p></blockquote><blockquote><p><strong>特殊指令：</strong> 用户向机器人发送 <strong>#reset</strong> 即可清空该用户的上下文记忆。</p></blockquote><h3 id="3-Docker部署"><a href="#3-Docker部署" class="headerlink" title="3.Docker部署"></a>3.Docker部署</h3><blockquote><p>使用docker部署无需下载源码和安装依赖，只需要获取 docker-compose.yml 配置文件并启动容器即可。</p></blockquote><blockquote><p>前提是需要安装好 <code>docker</code> 及 <code>docker-compose</code>，安装成功的表现是执行 <code>docker -v</code> 和 <code>docker-compose version</code> (或 docker compose version) 可以查看到版本号，可前往 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/">docker官网</a> 进行下载。</p></blockquote><p><strong>(1) 下载 docker-compose.yml 文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://open-1317903499.cos.ap-guangzhou.myqcloud.com/docker-compose.yml</span><br></pre></td></tr></table></figure><p>下载完成后打开 <code>docker-compose.yml</code> 修改所需配置，如 <code>OPEN_AI_API_KEY</code> 和 <code>GROUP_NAME_WHITE_LIST</code> 等。</p><p><strong>(2) 启动容器</strong></p><p>在 <code>docker-compose.yml</code> 所在目录下执行以下命令启动容器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> docker compose up -d</span><br></pre></td></tr></table></figure><p>运行 <code>sudo docker ps</code> 能查看到 NAMES 为 chatgpt-on-wechat 的容器即表示运行成功。</p><p>注意：</p><ul><li>如果 <code>docker-compose</code> 是 1.X 版本 则需要执行 <code>sudo docker-compose up -d</code> 来启动容器</li><li>该命令会自动去 <a target="_blank" rel="noopener" href="https://hub.docker.com/r/zhayujie/chatgpt-on-wechat">docker hub</a> 拉取 latest 版本的镜像，latest 镜像会在每次项目 release 新的版本时生成</li></ul><p>最后运行以下命令可查看容器运行日志，扫描日志中的二维码即可完成登录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> docker logs -f chatgpt-on-wechat</span><br></pre></td></tr></table></figure><p><strong>(3) 插件使用</strong></p><p>如果需要在docker容器中修改插件配置，可通过挂载的方式完成，将 <a target="_blank" rel="noopener" href="https://github.com/zhayujie/chatgpt-on-wechat/blob/master/plugins/config.json.template">插件配置文件</a><br>重命名为 <code>config.json</code>，放置于 <code>docker-compose.yml</code> 相同目录下，并在 <code>docker-compose.yml</code> 中的 <code>chatgpt-on-wechat</code> 部分下添加 <code>volumes</code> 映射:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">  - ./config.json:/app/plugins/config.json</span><br></pre></td></tr></table></figure><h3 id="4-Railway部署"><a href="#4-Railway部署" class="headerlink" title="4. Railway部署"></a>4. Railway部署</h3><blockquote><p>Railway 每月提供5刀和最多500小时的免费额度。 (07.11更新: 目前大部分账号已无法免费部署)</p></blockquote><ol><li>进入 <a target="_blank" rel="noopener" href="https://railway.app/template/qApznZ?referralCode=RC3znh">Railway</a></li><li>点击 <code>Deploy Now</code> 按钮。</li><li>设置环境变量来重载程序运行的参数，例如<code>open_ai_api_key</code>, <code>character_desc</code>。</li></ol><p><strong>一键部署:</strong></p><p><a target="_blank" rel="noopener" href="https://railway.app/template/qApznZ?referralCode=RC3znh"><a href="E:\Blog\blog\source_posts\button.svg+xml" title="Deploy on Railway" class="gallery-item" style="box-shadow:none"><img src="E:\Blog\blog\source_posts\button.svg+xml" alt="Deploy on Railway"></a></a></p><br><h1 id="🔎-常见问题"><a href="#🔎-常见问题" class="headerlink" title="🔎 常见问题"></a>🔎 常见问题</h1><p>FAQs： <a target="_blank" rel="noopener" href="https://github.com/zhayujie/chatgpt-on-wechat/wiki/FAQs">https://github.com/zhayujie/chatgpt-on-wechat/wiki/FAQs</a></p><p>或直接在线咨询 <a target="_blank" rel="noopener" href="https://link-ai.tech/app/Kv2fXJcH">项目小助手</a> (语料持续完善中，回复仅供参考)</p><h1 id="II-使用kimi"><a href="#II-使用kimi" class="headerlink" title="II. 使用kimi"></a>II. 使用kimi</h1><p>第三方转发的Openai的chatgpt的api key（也就是非官方的API）似乎不能用于本项目，建议想玩玩这个项目的同学使用<code>Kimi</code></p></div></div><div class="post-meta"><i><span>2024-11-18</span> <span>该篇文章被 Stone Ocean</span> <span>归为分类: <a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span></i></div><br><div class="post-footer-pre-next"><span>上一篇：<a href="/posts/761755511/">为了记念的纪念</a></span> <span class="post-footer-pre-next-last-span-right">下一篇：<a href="/posts/1392842668/">VS2022安装WIN</a></span></div><div class="comments-container"><div id="comment-anchor"></div><div class="comment-area-title"></div><div id="waline"></div><script type="module">import{init}from"https://npm.elemecdn.com/hexo-theme-a4@latest/source/js/waline.mjs";function loadWaline(){init({el:"#waline",serverURL:"https://y-shi23-github-io-8y29.vercel.app/",lang:"zh-CN",dark:'body[class~="dark-mode"]',requiredMeta:["nick","mail"],search:!1,reaction:!1,pageview:!1,comment:!1,locale:{placeholder:"留下你的评论吧!",sofa:""}})}window.addEventListener("DOMContentLoaded",loadWaline)</script></div></div><div class="footer"><span>© 2023-2024 Ocean / <a href="/friends/">友链</a></span></div><div class="footer-last"><span>那年夏天宁静的海</span></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript"></script><script src="/js/toc.js"></script><script src="/js/randomHeaderContent.js"></script><script src="/js/returnToTop.js"></script><script src="/js/returnToLastPage.js"></script><script src="/js/lightgallery/lightgallery.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script><script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script><script type="text/javascript">if("undefined"!=typeof lightGallery){var options1={selector:".gallery-item",plugins:[lgThumbnail,lgFullscreen,lgAutoplay,lgZoom,lgRotate,lgPager],thumbnail:!1,zoom:!1,rotate:!1,autoplay:!1,fullScreen:!1,pager:!1,zoomFromOrigin:!0,actualSize:!0,enableZoomAfter:300};lightGallery(document.getElementsByClassName(".article-gallery")[0],options1)}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="progress-wrap shadow-drop-2-bottom"><svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102"><path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/></svg></div><div class="return-to-last-progress-wrap shadow-drop-2-bottom"><svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102"><path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/></svg></div></div></body></html>